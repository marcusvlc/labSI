<!DOCTYPE html>
<html ng-app="sistema">
<head>
	<title>Sistema Angular</title>
	<meta charset="utf-8">
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
</head>
<body ng-controller="controlePrincipal">
<header class="container">
	<div class="row">
		<h2 ng-bind="titulo"></h2>

	</div>
</header>
<main class="container">
<div class="row">
	<input type="text" name="" ng-modeL="buscado.nome" placeholder="Buscar Artista">

</div>
	<div class="row">
		<table class="striped">

		<thead>
			<tr>
				<th>Nome</th>
				<th>Foto do Artista</th>
			</tr>
		</thead>

		<tbody>
			<tr ng-repeat="i in artistasCadastrados | filter:buscado">
				<td>{{i.nome}}</td>
				<td><img alt="Imagem inválida ou com link errado" src="{{i.imagem}}" width="100" height="100"></td>
			</tr>
		</tbody>
	</table>

	</div>

	<div class="row">
		  <!-- Modal Trigger -->
 	 <a class="waves-effect waves-light btn modal-trigger" href="#modal1">+ Adicionar Artista</a>
	</div>

</main>


  <!-- Modal Structure -->
  <div id="modal1" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4>Adicionar um artista no sistema</h4>
      <p>Preencha todas as informações para cadastrar um artista no sistema!</p>
      <div class="row">
      	  <div class="input-field col m6 s6">
          <input type="text" ng-modeL="Artista.nome" class="validate">
          <label>Nome do Artista</label>
        </div>
      	  <div class="input-field col m6 s6">
          <input type="text" ng-modeL="Artista.imagem" class="validate">
          <label>URL com imagem do artista</label>
        </div>

      </div>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Cancelar</a>

       	 <a ng-click="addArtista(Artista)" class="waves-effect waves-light btn blue">Cadastrar</a>


    </div>
  </div>

  <script type="text/javascript">
  	
  	$(document).ready(function(){
    	$('.modal').modal();
  });
  </script>




<script src="lib/angular/angular.min.js"></script>

<script type="text/javascript">
	angular.module("sistema", []).controller("controlePrincipal", 

		function($scope) {
			$scope.titulo = "Sistema de Música";
			$scope.artistasCadastrados = [ 
			{nome: "Liam Gallagher", imagem: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT4IxDsRit-p3i4rrALx0gYh2Fr6rSdYeOWkV-xHDW369VeWYBk1g"}

			];

			$scope.artistaExisteNoSistema = false;

			$scope.addArtista = function(Artista) {
				checagem(Artista);
				if(Artista.nome == "") {
					Materialize.toast('Alguma informação está incorreta, verifique e tente novamente!', 2000)
					limparFormulario();
				} else {
						if($scope.artistaExisteNoSistema == false) {
						$scope.artistasCadastrados.push(Artista);
						$('#modal1').modal('close');
						  // Materialize.toast(message, displayLength, className, completeCallback);
	  					Materialize.toast('Dados Salvos com sucesso!', 900) // 4000 is the duration of the toast
						limparFormulario();
					} else {
						Materialize.toast('O artista já existe no sistema, tente novamente!', 2000)
						limparFormulario();
					};
				};
				
			};

			$scope.editarArtista = function(Artista) {
				$('#modal1').modal('open');
			};	

			var limparFormulario = function() {
				$scope.Artista = {nome: "", imagem: ""};
				$scope.artistaExisteNoSistema = false;

			};

			var checagem = function(Artista) {
				for (var i = $scope.artistasCadastrados.length - 1; i >= 0; i--) {
					if($scope.artistasCadastrados[i].nome == Artista.nome){
						$scope.artistaExisteNoSistema = true;
					};
				};

				return $scope.artistaExisteNoSistema;
			};

		});

</script>
</body>
</html>